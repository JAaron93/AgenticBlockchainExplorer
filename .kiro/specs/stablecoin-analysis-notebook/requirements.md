# Requirements Document

## Introduction

This document specifies the requirements for a marimo Python notebook that analyzes stablecoin transaction data collected by the blockchain explorer agents. The notebook enables data scientists and analysts to determine whether users primarily use stablecoins (USDC, USDT, etc.) for everyday transactions or as a store of value. The analysis consumes JSON output files generated by the data collection agents and provides interactive visualizations and statistical insights.

## Glossary

- **Marimo**: A reactive Python notebook framework that creates reproducible, interactive notebooks as pure Python scripts
- **Stablecoin**: A cryptocurrency designed to maintain a stable value relative to a reference asset (typically USD)
- **USDC**: USD Coin, a stablecoin issued by Circle
- **USDT**: Tether, a stablecoin issued by Tether Limited
- **Transaction Activity**: Regular transfers of stablecoins between addresses with non-zero amounts
- **Store of Value (SoV)**: Holding pattern where tokens remain in an address for extended periods (>30 days) without outgoing transfers
- **Activity Type**: Classification of stablecoin usage - "transaction", "store_of_value", or "other" (minting/burning)
- **Chain**: The blockchain network (Ethereum, BSC, Polygon)
- **Holding Period**: Number of days since last outgoing transfer from an address
- **JSON Export**: The structured output file from the data collection agent containing transactions, holders, and summary data

## Requirements

### Requirement 1

**User Story:** As a data analyst, I want to load and parse stablecoin data from JSON export files, so that I can analyze the collected blockchain data.

#### Acceptance Criteria

1. WHEN the notebook initializes THEN the Notebook SHALL provide a file selector UI element to choose JSON export files from the output directory
2. WHEN a user selects a JSON file THEN the Notebook SHALL parse and validate the JSON structure against the expected schema
3. WHEN JSON parsing succeeds THEN the Notebook SHALL convert transaction and holder data into pandas DataFrames for analysis
4. IF the JSON file is malformed or missing required fields THEN the Notebook SHALL display a clear error message indicating the validation failure
5. WHEN data is loaded THEN the Notebook SHALL display metadata including run_id, collection timestamp, explorers queried, and total record count

### Requirement 2

**User Story:** As a data analyst, I want to see a breakdown of stablecoin usage by activity type, so that I can understand the primary use cases.

#### Acceptance Criteria

1. WHEN data is loaded THEN the Notebook SHALL calculate and display the count and percentage of transactions by activity type (transaction, store_of_value, other)
2. WHEN displaying activity breakdown THEN the Notebook SHALL render an interactive pie chart or bar chart showing the distribution
3. WHEN data is loaded THEN the Notebook SHALL calculate the total transaction volume (sum of amounts) for each activity type
4. WHEN displaying volume breakdown THEN the Notebook SHALL format amounts with appropriate decimal places and currency notation

### Requirement 3

**User Story:** As a data analyst, I want to compare stablecoin usage patterns across different tokens, so that I can identify differences between USDC and USDT behavior.

#### Acceptance Criteria

1. WHEN data is loaded THEN the Notebook SHALL group transactions by stablecoin type and calculate activity type distribution for each
2. WHEN displaying stablecoin comparison THEN the Notebook SHALL render a grouped bar chart comparing activity types across stablecoins
3. WHEN data is loaded THEN the Notebook SHALL calculate average transaction size per stablecoin
4. WHEN data is loaded THEN the Notebook SHALL calculate the ratio of store-of-value holders to active transactors per stablecoin

### Requirement 4

**User Story:** As a data analyst, I want to analyze holder behavior patterns, so that I can determine what percentage of holders use stablecoins as store of value.

#### Acceptance Criteria

1. WHEN data is loaded THEN the Notebook SHALL calculate the percentage of holders classified as store_of_value versus active transactors
2. WHEN displaying holder analysis THEN the Notebook SHALL render a histogram of holder balances segmented by store_of_value status
3. WHEN data is loaded THEN the Notebook SHALL calculate the average and median holding period for store_of_value holders
4. WHEN data is loaded THEN the Notebook SHALL identify the top 10 holders by balance and display their store_of_value classification

### Requirement 5

**User Story:** As a data analyst, I want to analyze transaction patterns over time, so that I can identify trends in stablecoin usage.

#### Acceptance Criteria

1. WHEN data is loaded THEN the Notebook SHALL parse transaction timestamps and create time-series aggregations
2. WHEN displaying time analysis THEN the Notebook SHALL render a line chart showing transaction count over time grouped by activity type
3. WHEN displaying time analysis THEN the Notebook SHALL render a line chart showing transaction volume over time grouped by stablecoin
4. WHEN data spans multiple days THEN the Notebook SHALL provide daily, weekly, and monthly aggregation options via UI controls

### Requirement 6

**User Story:** As a data analyst, I want to compare stablecoin usage across different blockchain networks, so that I can understand chain-specific patterns.

#### Acceptance Criteria

1. WHEN data is loaded THEN the Notebook SHALL group transactions by chain (Ethereum, BSC, Polygon) and calculate metrics for each
2. WHEN displaying chain comparison THEN the Notebook SHALL render a stacked bar chart showing activity type distribution per chain
3. WHEN data is loaded THEN the Notebook SHALL calculate average transaction size and gas costs per chain
4. WHEN data is loaded THEN the Notebook SHALL calculate the store_of_value ratio per chain

### Requirement 7

**User Story:** As a data analyst, I want to generate a summary conclusion about stablecoin usage patterns, so that I can answer whether stablecoins are used primarily for transactions or store of value.

#### Acceptance Criteria

1. WHEN analysis is complete THEN the Notebook SHALL calculate an overall "transaction vs store_of_value" ratio based on both transaction counts and holder classifications
2. WHEN displaying conclusions THEN the Notebook SHALL render a summary panel with key findings including dominant usage pattern, chain with highest transaction activity, and stablecoin with highest store_of_value ratio
3. WHEN displaying conclusions THEN the Notebook SHALL provide a confidence indicator based on sample size and data completeness
4. WHEN data contains errors from collection THEN the Notebook SHALL display warnings about data quality issues that may affect conclusions

### Requirement 8

**User Story:** As a data analyst, I want the notebook to work with sample data when no real dataset is available, so that I can validate the analysis logic.

#### Acceptance Criteria

1. WHEN no JSON file is selected THEN the Notebook SHALL offer an option to generate synthetic sample data
2. WHEN generating sample data THEN the Notebook SHALL create realistic transaction and holder records following the same schema as real exports
3. WHEN using sample data THEN the Notebook SHALL clearly indicate that analysis is based on synthetic data, not real blockchain data
4. WHEN generating sample data THEN the Notebook SHALL allow configuration of sample size and distribution parameters via UI controls
